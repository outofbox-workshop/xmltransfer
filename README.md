# xmltransfer
1. 工具简介本工具用于将策划编写的剧情 CSV 表格（newdialog.csv）批量转换为工程可用的 XML 格式（output_new.xml）。工具会自动读取角色、动作、背景的映射表，确保输出的 ID 正确。当前版本： 适配规则 1.5主要功能：自动映射 Character ID、Spine ID、Action ID、Background ID。自动识别 HCG 模式（强制居中）与普通立绘模式（左/中/右）。支持 spineScale、spineOffset、isLoop 等参数透传。2. 环境准备在使用脚本前，请确保电脑上已安装 Python 环境。安装 Python如果未安装，请前往 Python 官网 下载并安装（安装时请勾选 Add Python to PATH）。安装依赖库打开命令行（CMD 或 PowerShell），输入以下指令安装 pandas 库：Bashpip install pandas
3. 文件准备 (非常重要)请在电脑上新建一个文件夹，将脚本和以下 5 个文件放在同一个目录下。文件名必须严格一致，否则脚本无法识别。文件名说明关键列要求convert_new.py转换脚本本工具核心代码。newdialog.csv剧情主表需包含 DialogID, Figure, Spine, Background, IsLoop, spineScale, spineOffset 等列。figure.csv角色映射表需包含 名称 (Name) 和 ID。用于将中文名转为数字 ID。spine.csv动作映射表需包含 CharacterName, Name (中文动作名), SpineId, ActionId。background.csv背景映射表需包含 Name (中文名) 和 Id (资源ID)。⚠️ 注意： 所有 CSV 文件建议保存为 UTF-8 编码格式，防止乱码。4. 如何运行打开存放上述文件的文件夹。在文件夹空白处右键，选择 "在终端中打开" (Open in Terminal) 或 "Git Bash Here"。在弹出的黑框窗口中输入以下命令并回车：Bashpython convert_new.py
查看结果：如果运行成功，屏幕会显示 ✅ 转换成功！文件已保存为: ...\output_new.xml。同级目录下会生成一个新文件 output_new.xml，这就是最终产出。5. 核心转换逻辑 (给配置人员的提示)如果输出结果不符合预期，请检查 CSV 填写是否符合以下规则：(1) 角色与位置 (Figure & Position)FigureId：脚本会读取 newdialog.csv 中的 Figure 列，去 figure.csv 找对应 ID。位置判定：优先 HCG：如果 Spine 列有内容，位置强制为 middle。普通立绘：如果 Spine 列为空，脚本会检查 Figure 的名字出现在 LeftSpeakerPos / RightSpeakerPos / MiddleSpeakerPos 哪一列，来决定位置。(2) 动作与 HCG (SpineId & ActionId)HCG 模式：如果 newdialog.csv 的 Spine 列填了内容（如 ＨＣＧ...），脚本会直接去 spine.csv 查找对应的 SpineId 和 ActionId。默认站姿：如果 Spine 列为空，但有角色出场，脚本会自动去 spine.csv 查找该角色的默认动作（通常是“站姿”）。(3) 背景 (Background)脚本读取 Background 列（如 黑幕），去 background.csv 查找对应 ID（如 BLACK）。注意：如果映射表中找不到该背景名，XML 中该属性会留空。(4) 其他参数isLoop：直接读取 IsLoop 列。填 TRUE/1 输出 "true"，填 FALSE/0 输出 "false"，不填则为空。spineScale / spineOffset：直接读取对应列内容，原样填入 XML。6. 常见报错处理报错：ModuleNotFoundError: No module named 'pandas'原因：没安装依赖库。解决：运行 pip install pandas。报错：FileNotFoundError: ... newdialog.csv原因：文件名不对，或者文件没放在脚本旁边。解决：确保文件名完全一致，且在同一文件夹内。生成的 XML 里属性是空的 (如 background="")原因：映射表里没配这个名字。解决：检查 background.csv 或 spine.csv，确保名字和剧情表里写的一模一样（注意空格或换行符）。
